# プロジェクトガイドライン

ユーザーへの回答は全て日本語で行ってください。

## 概要

- **プロジェクト名**: medimo-prompt
- **目的**: 医療者向けカルテ作成支援AIツール「medimo」で使用するプロンプトを作成・保管する
- **対象ユーザー**: 回復期リハビリテーション病棟で勤務するセラピスト

## 入力データの特性と処理方針

本プロジェクトで扱うプロンプトは、**業務中の音声文字起こしテキスト**を入力として受け取ります。

### 入力データの特性

音声文字起こしテキストには以下の特性があります：

- **誤字・誤変換の多発**: 音声認識特有の変換ミスが含まれる
- **専門用語の誤認識**: 医学・リハビリテーション用語が一般用語に誤変換される
- **文脈依存性**: 単独では意味不明でも、文脈で判断可能な表現が含まれる
- **口語表現**: 話し言葉特有の冗長性や言い淀み、言い直しが含まれる

### 処理の基本方針

音声文字起こしテキストを処理する際は、以下の方針を厳守してください：

#### 1. 文脈に基づく適切な変換

- 誤字・誤変換を**文脈に沿って適切に修正**する
- 医学、リハビリテーション、介護に関する専門用語を**正確に変換**する
- 存在しない単語や意味不明な用語を**そのまま記録しない**

#### 2. 入力内容への厳格な忠実性

- **入力に含まれていない情報を予測・補完して記録しない**
- **あくまで入力内容に基づいて記述する**
- 不足している情報があっても、勝手に推測して追加しない
- 入力内容が不明確な場合は、可能な範囲で記録する

#### 3. 専門用語の適切な処理

以下の分野の専門用語を正確に認識・変換すること：

- **医学用語**: 疾患名、症状名、検査所見、治療法など
- **リハビリテーション用語**: 評価尺度（FIM、BRSなど）、訓練手技、機能評価など
- **介護用語**: ADL、IADL、介護度、サービス種別など
- **解剖学・運動学用語**: 筋肉名、関節名、運動方向など

#### 4. 禁止される処理

以下の処理は**絶対に行わない**こと：

- 存在しない単語・用語をそのままカルテに記述すること
- 入力にない情報を推測・予測して追加すること
- 文脈を無視した機械的な変換を行うこと
- 医学的に不適切な用語への変換を行うこと

### ディレクトリ構造

```
medimo-prompt/
├── README.md
├── AGENTS.md                     # AIコーディングツール用ガイドライン
├── LICENSE                       # ライセンス情報
├── .gitignore                    # Git除外設定
├── _legacy/                      # 過去のファイル
├── doc/                          # プロジェクトドキュメント
│   ├── domain_knowledge/         # ドメイン知識定義
│   └── sample-prompt/            # サンプルドキュメント
└── prompt/                       # プロンプト本体
    ├── medical-record/           # カルテ生成用プロンプト
    │   ├── pt-prompt-latest.md   # 理学療法士用
    │   ├── ot-prompt-latestt.md   # 作業療法士用
    │   └── st-prompt-latest.md   # 言語聴覚士用
    ├── meeting.md                # リハビリミーティング用
    └── pre-discharge-home-visit.md  # 退院前訪問指導用
```

## ガイドライン

本プロジェクトでは、**Markdown記法をベースに、XMLタグで構造化したプロンプト形式**を採用しています。

### プロンプト構造の基本要素

すべてのプロンプトは以下のXML要素で構成されます：

```xml
<task>
  タスクの明確な定義
</task>

<context>
  入力データの説明、背景情報
</context>

<domain_knowledge>
  <!-- 業務固有の知識を構造化して定義 -->
  <locations>
    院内の場所名の標準化定義
  </locations>
  <equipment>
    使用物品・機器の正式名称と仕様
  </equipment>
  <evaluations>
    評価方法の詳細と記述形式
  </evaluations>
</domain_knowledge>

<output_format>
  <structure>
    出力の構造
  </structure>
  <formatting_rules>
    書式のルール
  </formatting_rules>
</output_format>

<rules>
  <prohibited>
    禁止事項
  </prohibited>
  <required>
    必須事項
  </required>
</rules>

<procedure>
  <step number="1">
    <title>ステップのタイトル</title>
    <description>詳細説明</description>
    <criteria>判断基準</criteria>
  </step>
  <!-- 必要に応じて複数ステップ -->
</procedure>

<examples>
  <example number="1">
    <output>具体例</output>
  </example>
</examples>

<important_reminders>
  重要な注意事項の再確認
</important_reminders>
```

### プロンプト作成の原則

1. **明確性**: タスクと期待される出力を明示する
2. **構造化**: XMLタグで論理的に情報を整理する
3. **ドメイン知識の体系化**: `<domain_knowledge>`で業務固有の知識を構造化して定義する
4. **段階的**: `<procedure>`で処理手順を明確にステップ分けする
5. **制約の明示**: `<prohibited>`と`<required>`で境界を定義する
6. **具体例の提供**: `<examples>`で期待される出力の具体例を示す
7. **再確認**: `<important_reminders>`で重要ルールを再掲する
8. **入力の忠実性**: 入力内容にのみ基づき、推測・補完を禁止する
9. **文脈理解**: 音声文字起こし特有の誤字・誤変換をドメイン知識を参照して適切に修正する
10. **標準化**: 用語、場所名、物品名、評価形式を統一し、正確な記述を保証する

## 重要な注意事項

### 医療情報の取り扱い

- **実在の患者情報は絶対に使用しない**
- サンプルデータは完全に架空のものを使用する
- 氏名、生年月日、住所など個人を特定できる情報は一切含めない
- 実際の医療機関名、担当者名も使用しない

### プロンプトの品質基準

- AI出力が医療行為そのものではなく、**記録作成の補助**であることを明確にする
- 最終的な記録の責任はセラピストにあることを前提とする
- 医学的に不正確な出力を防ぐため、適切な制約を設ける

#### 音声文字起こし処理の品質基準

音声文字起こしテキストを処理するプロンプトは、以下の品質基準を満たすこと：

1. **誤変換検出・修正能力**
   - 文脈に基づいて誤字・誤変換を適切に検出できること
   - 専門用語の誤認識を正確に修正できること
   - 存在しない用語を検出し、適切な用語に変換できること
   - `<domain_knowledge>`セクションの情報を参照して、院内固有の場所名・物品名・評価名を正確に修正できること

2. **入力忠実性の保証**
   - 入力に含まれない情報を追加しない仕組みを持つこと
   - 推測・補完を明確に禁止する記述を含むこと
   - 入力内容の範囲を超えない出力を保証すること

3. **専門用語の正確性**
   - 医学・リハビリテーション・介護の専門用語を正確に認識すること
   - 専門用語の文脈依存的な使い分けができること
   - 略語と正式名称を適切に扱えること
   - 評価結果は指定された形式・単位・範囲で正確に記載すること（例: MMTは0-5、ROM-Tは5°刻み、BRSTはⅠ～Ⅵ）

4. **院内固有用語の標準化**
   - 場所名は`<locations>`で定義された標準名称を使用すること（例: 「リハスペース」「プラットフォーム」「吹き抜け階段」）
   - 物品・機器は`<equipment>`で定義された正式名称を使用すること（例: 「歩行器」→「キャスター付き歩行器」）
   - 機器の負荷設定は正確な単位と範囲で記載すること（例: リカンベントエルゴメーターは"W"または"負荷1-8"）

5. **文脈理解の深さ**
   - 単語単位ではなく、文脈全体から意味を理解すること
   - 口語表現を適切な書き言葉に変換できること
   - 言い淀みや言い直しを適切に処理できること

6. **検証可能性**
   - 出力が入力のどの部分に基づいているか追跡可能であること
   - 変換の根拠が明確であること
   - 不明瞭な箇所を明示できること

### 開発哲学

本プロジェクトは以下の哲学に基づいて開発されます：

#### 1. 明確性優先
- 曖昧さを排除し、AIが誤解する余地を最小化する
- 専門用語は文脈内で明確に定義する
- 期待される動作を具体的に記述する

#### 2. 再現性の保証
- 同じ入力に対して一貫した出力が得られるよう設計する
- ランダム性を排除し、決定論的な処理を優先する
- 手順を明確にステップ化し、追跡可能にする

#### 3. 保守性の確保
- プロンプトは構造化され、部分的な修正が容易である
- XML構造により、セクション単位での更新が可能
- バージョン管理により変更履歴を追跡する

#### 4. ドメイン専門性
- 医療・リハビリテーション分野の専門知識を反映する
- 業界標準（SOAP形式、FIMスケールなど）に準拠する
- 実務での使用に耐える品質を担保する

#### 5. ドメイン知識の体系化
- 業務固有の知識を`<domain_knowledge>`セクションで構造化して定義する
- 音声文字起こしの誤変換を修正する際の信頼できる参照元とする
- 院内固有の用語、場所名、物品名、評価形式を標準化する
- ドメイン知識は別ファイル（`doc/`ディレクトリ）で管理し、プロンプトに統合する

### 設計方針

#### プロンプトアーキテクチャ

1. **階層的構造**
   - トップレベル: タスク定義 (`<task>`)
   - コンテキストレイヤー: 入力情報 (`<context>`)
   - ドメイン知識レイヤー: 業務固有の知識体系 (`<domain_knowledge>`)
   - ルールレイヤー: 制約条件 (`<rules>`)
   - 実行レイヤー: 処理手順 (`<procedure>`)
   - 検証レイヤー: 例と再確認 (`<examples>`, `<important_reminders>`)

2. **ドメイン知識の構造化**
   - `<domain_knowledge>`セクションで業務固有の知識を体系的に定義
   - サブセクション例:
     - `<locations>`: 院内の場所名の標準化定義
     - `<equipment>`: 使用物品・機器の正式名称、仕様、負荷設定の単位と範囲
     - `<evaluations>`: 評価方法の詳細、記述形式、単位、判定基準
   - 音声文字起こしの誤変換を修正する際の参照元として機能
   - 院内固有の用語や表現を明示的に定義

3. **詳細度の段階化**
   - 各要素内でさらに細分化（例: `<criteria>`内の`<vital_signs>`, `<physical_examination>`, `<evaluations>`, `<rehabilitation_content>`, `<constraints>`）
   - ネストは3階層まで推奨
   - 過度な深さは可読性を損なうため避ける
   - 評価形式や物品仕様など、正確性が求められる情報は詳細に記述

4. **`<criteria>`の構造化パターン**
   
   `<procedure>`内の各ステップの`<criteria>`は、処理内容に応じて以下のサブ要素で構造化します：
   
   - **客観的情報(O)の生成ステップの場合**:
     ```xml
     <criteria>
       <vital_signs>バイタルサインの記載基準</vital_signs>
       <physical_examination>身体診察所見の記載基準</physical_examination>
       <evaluations>評価結果の記載基準と形式</evaluations>
       <rehabilitation_content>リハビリテーション実施内容の記載基準</rehabilitation_content>
       <constraints>制約事項（重複禁止、用語変換など）</constraints>
     </criteria>
     ```
   
   - **その他のステップの場合**:
     - 箇条書きで判断基準を列挙
     - 必要に応じてサブ要素で構造化
   
   この構造化により、複雑な処理ステップでも明確な指示が可能になります。

5. **命名規則**
   - タグ名は英語のスネークケース
   - 説明的で意味が明確な名前を使用
   - 医療用語は原則として日本語で記述（タグ内のコンテンツ）

6. **ファイル命名規則**
   - 職種別: `pt.md` (理学療法士), `ot.md` (作業療法士), `st.md` (言語聴覚士)
   - 機能別: ハイフン区切りの小文字 (例: `pre-discharge-home-visit.md`)
   - 拡張子は必ず `.md`

### プロジェクト要件・制約

#### 技術的要件

- **ファイル形式**: Markdown (`.md`)
- **文字エンコーディング**: UTF-8
- **改行コード**: LF (Unix形式)
- **XMLタグ**: 整形式（well-formed）であること

#### 出力形式の制約

プロンプトが生成する出力には以下の制約を設けること：

- **プレーンテキスト出力**: Markdown記法を使用しない（#-*等）
- **空白行**: 不要な空白行を挿入しない
- **箇条書き記号**: 統一された記号を使用（例: 「・」）
- **用語の一貫性**: 一般用語を医学用語に変換

#### 禁止事項の明示

各プロンプトには必ず`<prohibited>`セクションを設け、以下を含めること：

##### 一般的な禁止事項

- 使用禁止の言葉（例: 「患者」という単語）
- 禁止される出力形式（例: markdown記法、空白行の挿入）
- 含めてはいけない情報の種類
- 内容が重複してはならないセクションの組み合わせを具体的に指定する（例: SとOの内容重複禁止、患者の発言をOに含めることの禁止）

##### 音声文字起こし処理における禁止事項

音声文字起こしテキストを処理する際、以下を**必ず禁止事項として明記**すること：

1. **誤変換のまま記録**
   - 存在しない単語・用語をそのまま記載すること
   - 意味不明な表現を修正せず出力すること
   - 文脈上明らかに誤った用語を放置すること

2. **情報の予測・補完**
   - 入力に含まれていない情報を推測して追加すること
   - 「おそらく〜だろう」という推測に基づく記述を行うこと
   - 不足している情報を一般的な事例で補完すること

3. **過剰な解釈**
   - 入力の意図を拡大解釈して詳細を追加すること
   - 言及されていない症状・所見を記載すること
   - 暗黙的な情報を明示的に記録すること

4. **専門用語の誤変換放置**
   - 医学・リハビリテーション用語が誤変換されたまま記録すること
   - 一般用語で代替できる場合でも、専門用語として不適切な表現を使用すること

**例**:
- × 入力: 「歩行訓練を実施した」→ 出力: 「歩行訓練を実施した。バランスは良好であった。」（バランスの情報は入力にない）
- ○ 入力: 「歩行訓練を実施した」→ 出力: 「歩行訓練を実施した。」（入力内容のみを記録）
- × 入力: 「りょうきゅうの下肢」→ 出力: 「料給の下肢」（存在しない用語をそのまま記録）
- ○ 入力: 「りょうきゅうの下肢」→ 出力: 「両側の下肢」（文脈から適切に修正）
- × 入力: 「リハビリスペースで歩行器を使った」→ 出力: 「リハビリスペースで歩行器を使った」（場所名・物品名が不正確）
- ○ 入力: 「リハビリスペースで歩行器を使った」→ 出力: 「リハスペースでキャスター付き歩行器を使用した」（`<domain_knowledge>`を参照して正確に修正）
- × 入力: 「エルゴメーター負荷50で10分」→ 出力: 「エルゴメーター負荷50で10分」（機器名と負荷単位が不明確）
- ○ 入力: 「エルゴメーター負荷50で10分」→ 出力: 「リカンベントエルゴメーター50Wで10分」（機器の正式名称と負荷単位を明示）

#### 言語要件

- プロンプト本体: 日本語
- XMLタグ名: 英語
- 出力: 日本語（医学用語を含む）

#### `<important_reminders>`の活用

プロンプトの最後には必ず`<important_reminders>`セクションを設け、以下を含めること：

1. **重要な禁止事項の再掲**
   - `<prohibited>`で定義した最も重要な禁止事項を簡潔に再確認
   - 例: 「患者」という言葉は絶対に使用しない、markdown記法は一切使用しない

2. **出力形式の再確認**
   - 出力形式（plane text、セクション区切りなど）を再度明示
   - 例: 出力はplane textのみ、各セクション(S, O, A, P)の区別を明確にする

3. **ドメイン知識の参照指示**
   - `<domain_knowledge>`セクションの情報を参照して誤変換を修正することを再確認
   - 例: 音声文字起こしテキストに含まれる場所名・物品名・評価名の誤変換は、`<domain_knowledge>`セクションの情報を参照して正確に修正する

4. **正確性が求められる項目の強調**
   - 院内固有の場所名、物品の正式名称、評価結果の形式など、正確性が特に重要な項目を列挙
   - 例: 使用物品・機器は正式名称で記載し、負荷設定がある場合は正確な単位と範囲で記述する

この再確認により、AIが処理の最終段階で重要なルールを見落とすリスクを低減します。

### セキュリティ・プライバシー考慮事項

#### 個人情報保護

- **PHI (Protected Health Information)の除外**
  - 実在の患者データを含むサンプルは作成しない
  - テストデータは完全に匿名化・仮名化する
  - 実際の医療記録から直接コピーしない

- **識別子の取り扱い**
  - 氏名、生年月日、住所、電話番号、医療記録番号などは例にも含めない
  - サンプル会話は架空のシナリオで作成する

#### プロンプトインジェクション対策

- ユーザー入力（音声文字起こしテキスト）に含まれる可能性のある指示を無視するよう、プロンプトで明示する
- 出力形式を厳格に定義し、逸脱を防ぐ

#### データの機密性

- プロンプト自体には機密情報を含めない
- 医療機関固有の情報（病院名、部署名など）は汎用的な表現にする
- 公開リポジトリでの管理を前提とし、機密性の高い情報は別管理する

#### 医療安全

- **免責的な表現**
  - AIが診断や治療判断を行わないことを明確にする
  - 記録作成の補助ツールであることを明示する

- **検証の必要性**
  - 生成された記録は必ず医療専門家が確認することを前提とする
  - 自動生成された内容の責任は使用者にあることを明記する

### ドメイン知識の管理

#### ドメイン知識ファイルの構造

ドメイン知識は`doc/domain_knowledge/`ディレクトリで管理し、以下の構造を採用します：

```
doc/domain_knowledge/
├── evaluations/          # 評価方法の定義（職種別）
│   ├── evaluation-pt.md  # 理学療法士用評価
│   ├── evaluation-ot.md  # 作業療法士用評価（今後追加予定）
│   └── evaluation-st.md  # 言語聴覚士用評価（今後追加予定）
├── location/             # 院内の場所名の定義
│   ├── location-pt.md    # 理学療法士用場所定義
│   ├── location-ot.md    # 作業療法士用場所定義（今後追加予定）
│   └── location-st.md    # 言語聴覚士用場所定義（今後追加予定）
└── tools/                # 使用物品・機器の定義
    ├── tools-pt.md       # 理学療法士用物品定義
    ├── tools-ot.md       # 作業療法士用物品定義（今後追加予定）
    └── tools-st.md       # 言語聴覚士用物品定義（今後追加予定）
```

各職種で使用する場所、物品、評価方法が異なるため、職種別にファイルを分けて管理します。

#### ドメイン知識の記述ルール

1. **場所名の定義** (`location/location-*.md`)
   - 院内の全ての場所を階層的に整理
   - 別名や略称がある場合は併記（例: 「階段（もしくは"吹き抜け階段"）」）
   - 場所の特性や用途を簡潔に説明
   - 職種ごとに使用する場所が異なる場合は、職種別ファイルで管理

2. **物品・機器の定義** (`tools/tools-*.md`)
   - カテゴリごとに分類（歩行補助具、下肢運動機器など）
   - 正式名称を明記
   - 仕様や設定値の範囲を詳細に記載（例: 「リカンベントエルゴメーター: 負荷は"W（ワット）"形式と、"負荷1-8"形式の2種類が存在」）
   - 類似物品との区別を明確にする
   - 職種ごとに使用する物品が異なる場合は、職種別ファイルで管理

3. **評価方法の定義** (`evaluations/evaluation-*.md`)
   - 評価名の正式名称と略称
   - 評価の目的と対象
   - 判定基準（スケール、段階、単位）
   - 記述形式の具体例（コードブロックで明示）
   - 職種ごとに使用する評価を分けて管理

#### プロンプトへの統合方法

ドメイン知識ファイルの内容は、プロンプトの`<domain_knowledge>`セクションに統合します：

```xml
<domain_knowledge>
<locations>
{location/location-*.mdの内容}
</locations>

<equipment>
{tools/tools-*.mdの内容}
</equipment>

<evaluations>
{evaluations/evaluation-*.mdの内容}
</evaluations>
</domain_knowledge>
```

職種別のプロンプト（例: `prompt/medical-record/pt.md`）には、対応する職種のドメイン知識ファイル（例: `location-pt.md`, `tools-pt.md`, `evaluation-pt.md`）の内容を統合します。

#### ドメイン知識の更新プロセス

1. **新規用語の追加**
   - 実務で使用される新しい場所名、物品名、評価方法が発生した場合
   - 該当する`doc/domain_knowledge/`配下の職種別ファイルに追加
   - 関連するプロンプトの`<domain_knowledge>`セクションを更新

2. **用語の修正**
   - 誤りや不正確な定義を発見した場合
   - `doc/domain_knowledge/`配下の該当ファイルを修正
   - 影響を受けるすべてのプロンプトを更新

3. **仕様の変更**
   - 機器の負荷設定範囲の変更など
   - `doc/domain_knowledge/`配下の該当ファイルを更新
   - プロンプトの`<domain_knowledge>`と`<important_reminders>`を更新

**バージョン管理とレビュー**

- **コミット**: 変更はアトミックに保ち、コミットメッセージに変更理由を明確に記述します。大規模な変更は複数のコミットに分割してください。
- **テスト**: プロンプトを変更した後は、意図した通りに動作するかをサンプル入力で必ず確認してください。特に`<domain_knowledge>`の変更は、音声文字起こしの誤変換修正が正しく機能するかテストしてください。
- **レビュー**: 医療専門性に関わる変更は、関連する職種の担当者によるレビューを受けてください。
