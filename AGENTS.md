# プロジェクトガイドライン

ユーザーへの回答は全て日本語で行ってください。

## 概要

- **プロジェクト名**: medimo-prompt
- **目的**: 医療者向けカルテ作成支援AIツール「medimo」で使用するプロンプトを作成・保管する
- **対象ユーザー**: 回復期リハビリテーション病棟で勤務するセラピスト

### ディレクトリ構造

```
medimo-prompt/
├── README.md        # プロジェクト説明
├── AGENTS.md
├── CLAUDE.md
├── .claude
│   └── settings.json
├── doc/             # プロジェクトドキュメント
└── prompt/
    ├── medical-record/   # カルテ生成用プロンプト
    │   ├── pt.md         # 理学療法士用
    │   ├── ot.md         # 作業療法士用
    │   └── st.md         # 言語聴覚士用
    ├── meeting.md        # リハミーティング用プロンプト
    └── pre-discharge-home-visit.md        # 退院前訪問指導用
```

## ガイドライン

本プロジェクトでは、**Markdown記法をベースに、XMLタグで構造化したプロンプト形式**を採用しています。

### プロンプト構造の基本要素

すべてのプロンプトは以下のXML要素で構成されます：

```xml
<task>
  タスクの明確な定義
</task>

<context>
  入力データの説明、背景情報
</context>

<output_format>
  <structure>
    出力の構造
  </structure>
  <formatting_rules>
    書式のルール
  </formatting_rules>
</output_format>

<rules>
  <prohibited>
    禁止事項
  </prohibited>
  <required>
    必須事項
  </required>
</rules>

<procedure>
  <step number="1">
    <title>ステップのタイトル</title>
    <description>詳細説明</description>
    <criteria>判断基準</criteria>
  </step>
  <!-- 必要に応じて複数ステップ -->
</procedure>

<examples>
  <example number="1">
    <output>具体例</output>
  </example>
</examples>

<important_reminders>
  重要な注意事項の再確認
</important_reminders>
```

### プロンプト作成の原則

1. **明確性**: タスクと期待される出力を明示する
2. **構造化**: XMLタグで論理的に情報を整理する
3. **段階的**: `<procedure>`で処理手順を明確にステップ分けする
4. **制約の明示**: `<prohibited>`と`<required>`で境界を定義する
5. **具体例の提供**: `<examples>`で期待される出力の具体例を示す
6. **再確認**: `<important_reminders>`で重要ルールを再掲する

## 重要な注意事項

### 医療情報の取り扱い

- **実在の患者情報は絶対に使用しない**
- サンプルデータは完全に架空のものを使用する
- 氏名、生年月日、住所など個人を特定できる情報は一切含めない
- 実際の医療機関名、担当者名も使用しない

### プロンプトの品質基準

- AI出力が医療行為そのものではなく、**記録作成の補助**であることを明確にする
- 最終的な記録の責任はセラピストにあることを前提とする
- 医学的に不正確な出力を防ぐため、適切な制約を設ける

### 開発哲学

本プロジェクトは以下の哲学に基づいて開発されます：

#### 1. 明確性優先
- 曖昧さを排除し、AIが誤解する余地を最小化する
- 専門用語は文脈内で明確に定義する
- 期待される動作を具体的に記述する

#### 2. 再現性の保証
- 同じ入力に対して一貫した出力が得られるよう設計する
- ランダム性を排除し、決定論的な処理を優先する
- 手順を明確にステップ化し、追跡可能にする

#### 3. 保守性の確保
- プロンプトは構造化され、部分的な修正が容易である
- XML構造により、セクション単位での更新が可能
- バージョン管理により変更履歴を追跡する

#### 4. ドメイン専門性
- 医療・リハビリテーション分野の専門知識を反映する
- 業界標準（SOAP形式、FIMスケールなど）に準拠する
- 実務での使用に耐える品質を担保する

### 設計方針

#### プロンプトアーキテクチャ

1. **階層的構造**
   - トップレベル: タスク定義 (`<task>`)
   - コンテキストレイヤー: 入力情報 (`<context>`)
   - ルールレイヤー: 制約条件 (`<rules>`)
   - 実行レイヤー: 処理手順 (`<procedure>`)
   - 検証レイヤー: 例と再確認 (`<examples>`, `<important_reminders>`)

2. **詳細度の段階化**
   - 各要素内でさらに細分化（例: `<criteria>`内の`<vital_signs>`, `<physical_examination>`）
   - ネストは3階層まで推奨
   - 過度な深さは可読性を損なうため避ける

3. **命名規則**
   - タグ名は英語のスネークケース
   - 説明的で意味が明確な名前を使用
   - 医療用語は原則として日本語で記述（タグ内のコンテンツ）

4. **ファイル命名規則**
   - 職種別: `pt.md` (理学療法士), `ot.md` (作業療法士), `st.md` (言語聴覚士)
   - 機能別: ハイフン区切りの小文字 (例: `pre-discharge-home-visit.md`)
   - 拡張子は必ず `.md`

### プロジェクト要件・制約

#### 技術的要件

- **ファイル形式**: Markdown (`.md`)
- **文字エンコーディング**: UTF-8
- **改行コード**: LF (Unix形式)
- **XMLタグ**: 整形式（well-formed）であること

#### 出力形式の制約

プロンプトが生成する出力には以下の制約を設けること：

- **プレーンテキスト出力**: Markdown記法を使用しない（pt.md参照）
- **空白行**: 不要な空白行を挿入しない
- **箇条書き記号**: 統一された記号を使用（例: 「・」）
- **用語の一貫性**: 一般用語を医学用語に変換

#### 禁止事項の明示

各プロンプトには必ず`<prohibited>`セクションを設け、以下を含めること：

- 使用禁止の言葉（例: 「患者」という単語）
- 禁止される出力形式
- 含めてはいけない情報の種類
- セクション間での重複禁止

#### 言語要件

- プロンプト本体: 日本語
- XMLタグ名: 英語
- 出力: 日本語（医学用語を含む）

### セキュリティ・プライバシー考慮事項

#### 個人情報保護

- **PHI (Protected Health Information)の除外**
  - 実在の患者データを含むサンプルは作成しない
  - テストデータは完全に匿名化・仮名化する
  - 実際の医療記録から直接コピーしない

- **識別子の取り扱い**
  - 氏名、生年月日、住所、電話番号、医療記録番号などは例にも含めない
  - サンプル会話は架空のシナリオで作成する

#### プロンプトインジェクション対策

- ユーザー入力（音声文字起こしテキスト）に含まれる可能性のある指示を無視するよう、プロンプトで明示する
- 出力形式を厳格に定義し、逸脱を防ぐ

#### データの機密性

- プロンプト自体には機密情報を含めない
- 医療機関固有の情報（病院名、部署名など）は汎用的な表現にする
- 公開リポジトリでの管理を前提とし、機密性の高い情報は別管理する

#### 医療安全

- **免責的な表現**
  - AIが診断や治療判断を行わないことを明確にする
  - 記録作成の補助ツールであることを明示する

- **検証の必要性**
  - 生成された記録は必ず医療専門家が確認することを前提とする
  - 自動生成された内容の責任は使用者にあることを明記する

**ファイル操作時の注意:**

- **変更前のバックアップ**: 既存プロンプトを修正する場合は、変更理由をコミットメッセージに明記する
- **段階的な変更**: 大規模な変更は複数のコミットに分割する
- **テストの実施**: プロンプト変更後は、サンプル入力で動作を確認する
- **レビュープロセス**: 医療専門性に関わる変更は、関連職種の確認を得る
- **バージョン管理**: Gitで履歴を管理し、必要に応じてロールバック可能にする

